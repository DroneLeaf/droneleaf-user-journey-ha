<div class="flex flex-col relative">
  <!-- Label -->
  <label class="text-sm font-medium mb-1" [class.required]="required">
    {{ label }}
  </label>

  <div class="relative">
    <!-- Regular input -->
    <ng-container *ngIf="!textarea; else textareaBlock">
      <ion-input [formControl]="control" [placeholder]="placeholder" [type]="inputType" [clearInput]="clearInput"
        [maxlength]="maxlength" shape="round" mode="md" class="border rounded-md px-3 py-2 w-full pr-10"
        [class.error]="showError" [class.success]="isValid"></ion-input>
    </ng-container>

    <!-- Textarea -->
    <ng-template #textareaBlock>
      <textarea [formControl]="control" [placeholder]="placeholder" rows="4"
        class="border-[#009169] border rounded-md px-3 py-2 w-full resize-none focus:outline-none bg-white focus:ring-[#009169]"
        [maxlength]="maxlength" [class.error]="showError" [class.success]="isValid"></textarea>
    </ng-template>

    <!-- ℹ Info icon with tooltip (controlled by showTooltip) -->
<div class="absolute right-3 top-1/2 transform -translate-y-1/2 z-50" *ngIf="showTooltip && tooltipText">
  <div class="relative inline-block group">
    <!-- Info Icon -->
    <img
      src="../../../../../assets/svgs/private/info-icon.svg"
      class="w-5 h-5 text-gray-500 cursor-pointer"
      alt="info icon"
    />

    <!-- Tooltip -->
    <div
      class="absolute left-full ml-1 top-1/2 -translate-y-1/2
             w-[360px] bg-white border border-gray-300 rounded-lg shadow-lg flex
             opacity-0 transition duration-200 ease-in-out
             pointer-events-none
             group-hover:opacity-100 group-hover:pointer-events-auto"
    >
      <!-- Arrow -->
      <div
        class="absolute -left-2 top-1/2 -translate-y-1/2
               w-4 h-4 bg-white border-l border-b border-gray-300 rotate-45"
      ></div>

      <!-- Tooltip Content -->
      <div class="p-3 text-sm text-gray-700 flex text-justify gap-5">
        {{ tooltipText }}
        <img *ngIf="tooltipImage" [src]="tooltipImage" alt="tooltip" class="mt-2 w-20 h-auto" />
      </div>
    </div>
  </div>
</div>






    <!-- ✅ Validation status icons -->
    <div class="absolute right-8 top-1/2 transform -translate-y-1/2" *ngIf="control?.touched">
      <svg *ngIf="showError" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" fill="none"
        viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 8v4m0 4h.01M12 2a10 10 0 100 20 10 10 0 000-20z" />
      </svg>
      <svg *ngIf="isValid" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-500" fill="none"
        viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </div>



    <!-- 👁 Password visibility toggle -->
<div *ngIf="type === 'password'"
  class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer z-10"
  (click)="togglePasswordVisibility()">

  <!-- Eye Open (Your Custom SVG) -->
  <svg *ngIf="!showPassword" width="20" height="20" viewBox="0 0 27 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M13.125 0C4.36406 0 0.2625 7.71094 0.0984375 8.03907C-0.0328125 8.26875 -0.0328125 8.53125 0.0984375 8.76094C0.2625 9.08906 4.39688 16.8 13.125 16.8C21.8531 16.8 25.9875 9.08906 26.1516 8.76094C26.2828 8.53125 26.2828 8.26875 26.1516 8.03907C25.9875 7.71094 21.8859 0 13.125 0ZM13.125 15.2578C6.33281 15.2578 2.55938 9.84375 1.67344 8.4C2.55938 6.95625 6.36563 1.54219 13.125 1.54219C19.8844 1.54219 23.6906 6.95625 24.5766 8.4C23.6906 9.84375 19.9172 15.2578 13.125 15.2578Z" fill="#B4BBBE"/>
    <path d="M13.1219 3.70703C10.5297 3.70703 8.42969 5.80703 8.42969 8.39922C8.42969 10.9914 10.5297 13.0914 13.1219 13.0914C15.7141 13.0914 17.8141 10.9914 17.8141 8.39922C17.8141 5.80703 15.7141 3.70703 13.1219 3.70703ZM13.1219 11.5492C11.3828 11.5492 9.97188 10.1383 9.97188 8.39922C9.97188 6.66016 11.3828 5.24922 13.1219 5.24922C14.8609 5.24922 16.2719 6.66016 16.2719 8.39922C16.2719 10.1383 14.8609 11.5492 13.1219 11.5492Z" fill="#B4BBBE"/>
  </svg>

  <!-- Eye Closed (Crossed out version) -->
  <svg *ngIf="showPassword" width="20" height="20" viewBox="0 0 27 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M13.125 0C4.36406 0 0.2625 7.71094 0.0984375 8.03907C-0.0328125 8.26875 -0.0328125 8.53125 0.0984375 8.76094C0.2625 9.08906 4.39688 16.8 13.125 16.8C21.8531 16.8 25.9875 9.08906 26.1516 8.76094C26.2828 8.53125 26.2828 8.26875 26.1516 8.03907C25.9875 7.71094 21.8859 0 13.125 0ZM13.125 15.2578C6.33281 15.2578 2.55938 9.84375 1.67344 8.4C2.55938 6.95625 6.36563 1.54219 13.125 1.54219C19.8844 1.54219 23.6906 6.95625 24.5766 8.4C23.6906 9.84375 19.9172 15.2578 13.125 15.2578Z" fill="#B4BBBE"/>
    <path d="M13.1219 3.70703C10.5297 3.70703 8.42969 5.80703 8.42969 8.39922C8.42969 10.9914 10.5297 13.0914 13.1219 13.0914C15.7141 13.0914 17.8141 10.9914 17.8141 8.39922C17.8141 5.80703 15.7141 3.70703 13.1219 3.70703ZM13.1219 11.5492C11.3828 11.5492 9.97188 10.1383 9.97188 8.39922C9.97188 6.66016 11.3828 5.24922 13.1219 5.24922C14.8609 5.24922 16.2719 6.66016 16.2719 8.39922C16.2719 10.1383 14.8609 11.5492 13.1219 11.5492Z" fill="#B4BBBE"/>
    <!-- Diagonal line for "closed" state -->
    <line x1="2" y1="2" x2="25" y2="15" stroke="#B4BBBE" stroke-width="2" stroke-linecap="round"/>
  </svg>
</div>


    <!-- ✅ Validation status icons -->
    <div class="absolute right-8 top-1/2 transform -translate-y-1/2" *ngIf="control?.touched">
      <ion-icon *ngIf="showError" name="alert-circle" class="text-red-500 text-lg"></ion-icon>
      <ion-icon *ngIf="isValid" name="checkmark-circle" class="text-green-500 text-lg"></ion-icon>
    </div>
  </div>

  <!-- Helper text -->
  <div *ngIf="helperText && !showError" class="helper-text" [id]="'helper-' + generateId()">
    {{ helperText }}
  </div>

  <!-- Error message -->
  <div *ngIf="showError" class="error-message" [id]="'error-' + generateId()" role="alert">
    <ion-icon name="alert-circle" class="error-icon"></ion-icon>
    {{ getErrorMessage() }}
  </div>

  <!-- Character count -->
  <div *ngIf="maxlength && control?.value" class="character-count">
    {{ (control?.value || '').length }}/{{ maxlength }}
  </div>
</div>
