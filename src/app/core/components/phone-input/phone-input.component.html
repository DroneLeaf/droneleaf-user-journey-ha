<div class="flex flex-col">
  <label class="text-sm font-medium mb-1" [class.required]="required">
    {{ label }}
  </label>

  <div class="phone-input-container" [class.error]="isInvalid" [class.success]="isValid">
    <!-- Country Selector Section -->
    <div class="country-selector" #dropdownRef>
      <button type="button" (click)="toggleDropdown()" class="country-button">
        <span class="flag">{{ selectedCountry.flag || 'ðŸ‡¦ðŸ‡ª' }}</span>
        <svg class="dropdown-arrow" [class.rotated]="showDropdown" width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1 1.44159C1 1.55453 1.04708 1.66748 1.14191 1.75336L5.65782 5.87074C5.84684 6.04309 6.1533 6.04309 6.34232 5.87074L10.8582 1.75336C11.0473 1.58101 11.0473 1.3016 10.8582 1.12926C10.6692 0.956914 10.3628 0.956914 10.1737 1.12926L5.99976 4.93488L1.82579 1.12926C1.63676 0.956914 1.3303 0.956914 1.14128 1.12926C1.04709 1.21572 1 1.32866 1 1.44159Z" fill="#3A3B3E"/>
        </svg>
      </button>

      <!-- Dropdown Menu -->
      <div *ngIf="showDropdown" class="dropdown-menu">
        <div class="search-section">
          <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange($event)"
            placeholder="Search country..." class="search-input"
            [ngModelOptions]="{ standalone: true }" />
        </div>
        <div class="countries-list">
          <div *ngFor="let country of filteredCountries" (click)="onCountryChange(country)"
            class="country-item">
            <span class="country-flag">{{ country.flag }}</span>
            <span class="country-name">{{ country.name }}</span>
            <span class="country-code">{{ country.dial_code }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Separator -->
    <div class="separator"></div>

    <!-- Country Code Display -->
    <div class="country-code-display">
      {{ selectedCountry.dial_code }}
    </div>

    <!-- Phone Number Input -->
    <input type="tel" [formControl]="control" placeholder="Enter phone number"
      class="phone-input" (keypress)="allowOnlyNumbers($event)"
      (paste)="preventNonNumericPaste($event)" maxlength="15" />
  </div>

  <!-- Error messages -->
  <div *ngIf="showError" class="text-red-500 text-xs mt-1 flex items-center gap-1">
    <ion-icon name="alert-circle" class="text-red-500 text-sm"></ion-icon>
    {{ getErrorMessage() }}
  </div>
</div>
