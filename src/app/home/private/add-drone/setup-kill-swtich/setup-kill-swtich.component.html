<div class="flex flex-col lg:flex-row bg-white text-black">
  <!-- Main Left -->
  <div class="flex flex-col flex-1 h-full relative p-10">
    <!-- Top Header -->
    <div class="flex justify-between items-center px-6 py-4">
      <img src="../../../../../assets/svgs/private/Group 1597881310.svg" alt="DroneLeaf Logo" class="h-14" />
      <app-help-button></app-help-button>
    </div>

    <!-- Main Content Area with padding at bottom for fixed buttons -->
    <div class="flex-1 overflow-y-auto px-6 pb-24">
      <!-- Heading -->
      <h2 class="text-xl font-semibold">Set Up Your RC Kill-Switch</h2>
      <p class="text-gray-600">This feature lets you instantly cut motor power in emergencies.</p>

      <!-- Safety Notice -->
      <div class="p-4 bg-[#fff6d6] border my-3 border-[#FFC700] rounded">
        <p class="font-semibold">⚠️ Important Safety Notice</p>

        <ul class="list-disc ml-6 space-y-1">
          <li class="text-sm">Remove all propellers before connecting power or testing switches.</li>
          <li class="text-sm">Use a clear workspace; keep loose items & people away.</li>
          <li class="text-sm">A latching kill-switch prevents motors from re-arming the moment you let go. Avoid
            momentary switches for this function.</li>
        </ul>
      </div>

      <div class="space-y-6 border border-[#D1DADF] p-5 rounded-md">
        <!-- Heading -->
        <h2 class="text-lg font-semibold">
          Verify the Kill-switch (Channel 7)
        </h2>
        <p class="text-gray-600">
          We'll confirm the switch cuts motor power (ON) and then returns to safe (OFF).
        </p>

        <!-- Top Section: Switch Panels + Steps -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
          <!-- ON / OFF Panels -->
          <div class="border border-gray-200 rounded-md p-5 space-y-4">
            <!-- Title + Description -->
            <div>
              <p class="text-gray-600 text-sm">
                Flip your transmitter's kill-switch. The panel below reflects the live state.
              </p>
            </div>

            <!-- ON / OFF Panels -->
            <div class="grid grid-cols-2 gap-4">
              <!-- ON -->
              <div
                class="flex items-center justify-center border rounded-lg h-36 cursor-pointer text-xl font-extrabold transition"
                [ngClass]="{
                  'bg-[#f2f9f7] border-[#009169] text-[#009169]': currentState === 'ON',
                  'bg-white border-gray-300 text-gray-700': currentState !== 'ON'
                }" (click)="setSwitch('ON')">
                ON
              </div>

              <!-- OFF -->
              <div
                class="flex items-center justify-center border rounded-lg h-36 cursor-pointer text-xl font-extrabold transition"
                [ngClass]="{
                  'bg-[#f2f9f7] border-[#009169] text-[#009169]': currentState === 'OFF',
                  'bg-white border-gray-300 text-gray-700': currentState !== 'OFF'
                }" (click)="setSwitch('OFF')">
                OFF
              </div>
            </div>
          </div>

          <!-- Steps -->
          <div class="space-y-4">
            <!-- Step 1 -->
            <div class="p-3 border rounded-md transition" [ngClass]="{
              'border-[#009169] bg-[#f2f9f7]': stepEngageActive || stepEngageDone,
              'border-gray-300 bg-white': !stepEngageActive && !stepEngageDone
            }">
              <div class="flex items-center gap-3">
                <!-- Number / Tick -->
                <div class="w-7 h-7 flex items-center justify-center rounded-full text-sm font-semibold" [ngClass]="{
                  'bg-[#009169] text-white': stepEngageActive,
                  'bg-gray-200 text-gray-600': !stepEngageActive && !stepEngageDone
                }">
                  <ng-container *ngIf="!stepEngageDone; else tick1">1</ng-container>
                  <ng-template #tick1>
                    <!-- Tick -->
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path
                        d="M8 0C3.592 0 0 3.592 0 8C0 12.408 3.592 16 8 16C12.408 16 16 12.408 16 8C16 3.592 12.408 0 8 0ZM11.824 6.16L7.288 10.696C7.176 10.808 7.024 10.872 6.864 10.872C6.704 10.872 6.552 10.808 6.44 10.696L4.176 8.432C3.944 8.2 3.944 7.816 4.176 7.584C4.408 7.352 4.792 7.352 5.024 7.584L6.864 9.424L10.976 5.312C11.208 5.08 11.592 5.08 11.824 5.312C12.056 5.544 12.056 5.92 11.824 6.16Z"
                        fill="#009169" />
                    </svg>
                  </ng-template>
                </div>

                <div>
                  <p class="font-medium">Engage the kill-switch (ON)</p>
                  <p class="text-sm text-gray-600">
                    Flip the transmitter's kill-switch to ON. The ON <br />
                    panel will light up when detected.
                  </p>
                </div>
              </div>
            </div>

            <!-- Step 2 -->
            <div class="p-3 border rounded-md transition" [ngClass]="{
              'border-[#009169] bg-[#f2f9f7]': stepReleaseActive || stepReleaseDone,
              'border-gray-300 bg-white': !stepReleaseActive && !stepReleaseDone
            }">
              <div class="flex items-center gap-3">
                <!-- Number / Tick -->
                <div class="w-7 h-7 flex items-center justify-center rounded-full text-sm font-semibold" [ngClass]="{
                  'bg-[#009169] text-white': stepReleaseActive,
                  'bg-gray-200 text-gray-600': !stepReleaseActive && !stepReleaseDone
                }">
                  <ng-container *ngIf="!stepReleaseDone; else tick2">2</ng-container>
                  <ng-template #tick2>
                    <!-- Tick -->
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path
                        d="M8 0C3.592 0 0 3.592 0 8C0 12.408 3.592 16 8 16C12.408 16 16 12.408 16 8C16 3.592 12.408 0 8 0ZM11.824 6.16L7.288 10.696C7.176 10.808 7.024 10.872 6.864 10.872C6.704 10.872 6.552 10.808 6.44 10.696L4.176 8.432C3.944 8.2 3.944 7.816 4.176 7.584C4.408 7.352 4.792 7.352 5.024 7.584L6.864 9.424L10.976 5.312C11.208 5.08 11.592 5.08 11.824 5.312C12.056 5.544 12.056 5.92 11.824 6.16Z"
                        fill="#009169" />
                    </svg>
                  </ng-template>
                </div>

                <div>
                  <p class="font-medium">Release the kill-switch (OFF)</p>
                  <p class="text-sm text-gray-600">
                    Flip the switch back to OFF. The OFF panel will <br />
                    light up when detected.
                  </p>
                </div>
              </div>
            </div>

            <!-- Step 3 -->
            <div class="p-3 border rounded-md transition" [ngClass]="{
              'border-[#009169] bg-[#f2f9f7]': stepFinishActive || stepFinishDone,
              'border-gray-300 bg-white': !stepFinishActive && !stepFinishDone
            }">
              <div class="flex items-center gap-3">
                <!-- Number / Tick -->
                <div class="w-7 h-7 flex items-center justify-center rounded-full text-sm font-semibold" [ngClass]="{
                  'bg-[#009169] text-white': stepFinishActive,
                  'bg-gray-200 text-gray-600': !stepFinishActive && !stepFinishDone
                }">
                  <ng-container *ngIf="!stepFinishDone; else tick3">3</ng-container>
                  <ng-template #tick3>
                    <!-- Tick -->
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path
                        d="M8 0C3.592 0 0 3.592 0 8C0 12.408 3.592 16 8 16C12.408 16 16 12.408 16 8C16 3.592 12.408 0 8 0ZM11.824 6.16L7.288 10.696C7.176 10.808 7.024 10.872 6.864 10.872C6.704 10.872 6.552 10.808 6.44 10.696L4.176 8.432C3.944 8.2 3.944 7.816 4.176 7.584C4.408 7.352 4.792 7.352 5.024 7.584L6.864 9.424L10.976 5.312C11.208 5.08 11.592 5.08 11.824 5.312C12.056 5.544 12.056 5.92 11.824 6.16Z"
                        fill="#009169" />
                    </svg>
                  </ng-template>
                </div>

                <div>
                  <p class="font-medium">Finish</p>
                  <p class="text-sm text-gray-600">Kill-switch verified. You may proceed.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-12 gap-4 items-start">
          <!-- Logs Box (6 col) -->
          <div class="col-span-12 md:col-span-6 p-4 bg-[#F8FAFB] border border-[#D1DADF] rounded-md text-sm space-y-1 min-h-[100px]">
            <ng-container *ngIf="logs.length > 0; else noLogs">
              <p class="text-[#90A2B9]" *ngFor="let log of logs">{{ log }}</p>
            </ng-container>
            <ng-template #noLogs>
              <p class="text-[#90A2B9]">Logs will appear here...</p>
            </ng-template>
          </div>

          <!-- Action Button (6 col) -->
          <div class="col-span-12 md:col-span-6 flex items-start">
            <button class="px-5 py-2 rounded font-semibold transition" [ngClass]="{
                'bg-[#009169] text-white hover:bg-[#007e57]': actionButton === 'Start Verification',
                'bg-gray-200 text-gray-700 hover:bg-gray-300 cursor-not-allowed': actionButton !== 'Start Verification'
              }" (click)="
                actionButton === 'Start Verification'
                  ? startVerification()
                  : actionButton === 'Retest'
                  ? retest()
                  : null
              " [disabled]="actionButton !== 'Start Verification' && actionButton !== 'Retest'">
              {{ actionButton }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Fixed Bottom Buttons -->
    <div class="fixed bottom-0 left-0 right-0 lg:right-96 flex flex-col md:flex-row justify-between items-center gap-4 p-4 border-t bg-white z-20 shadow-md">
      <button type="button"
        class="bg-red-600 text-white font-semibold py-2 px-6 rounded-md hover:bg-red-700 w-full md:w-auto"
        (click)="onCancelClick()">
        Cancel
      </button>

      <div class="flex gap-4 w-full md:w-auto">
        <button
          class="border border-[#009169] text-gray-700 font-semibold py-2 px-6 rounded-md hover:bg-gray-100 w-full md:w-auto"
          style="border: 1px solid #009169;"
          (click)="back.emit()">
          Back
        </button>

        <button class="text-white font-semibold py-2 px-6 rounded-md transition-colors duration-200 w-full md:w-auto"
          [ngClass]="{
            'bg-[#009169] hover:bg-[#007e57]': stepEngageDone && stepReleaseDone && stepFinishDone,
            'bg-[#80c8b4] cursor-not-allowed': !(stepEngageDone && stepReleaseDone && stepFinishDone)
          }" [disabled]="!(stepEngageDone && stepReleaseDone && stepFinishDone)" (click)="next.emit()">
          Continue
        </button>
      </div>
    </div>
  </div>

  <!-- Right Sidebar Stepper - Only this will scroll if needed -->
  <div class="w-full lg:w-96 bg-[#cce9e1] h-full overflow-y-auto">
    <div class="p-6 flex flex-col justify-between min-h-full">
      <app-add-drone-stepper [steps]="steps" [currentStepIndex]="currentStepIndex"></app-add-drone-stepper>

      <div class="mt-8">
        <h4 class="text-[22px] font-semibold text-gray-800 mb-1">
          Add A Drone
        </h4>
        <p class="text-[16px] text-gray-600">
          This step ensures your Remote Control is properly configured before
          finalizing the setup.
        </p>
      </div>
    </div>
  </div>
</div>
