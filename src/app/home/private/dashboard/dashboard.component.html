<div class="p-4 md:p-6 grid grid-cols-1 xl:grid-cols-3 gap-6">
  <!-- Left Section -->
  <div class="xl:col-span-2 flex flex-col gap-[1rem]">
    <!-- Welcome Header -->
    <div class="bg-white rounded-xl border border-[#D1DADF] p-4 sm:p-6 mt-4">
      <div
        class="flex flex-col md:flex-row items-center md:items-start justify-between gap-4"
      >
        <!-- Left Text Block -->
        <div class="text-center md:text-left sm:mt-6 mx-5">
          <h2 class="text-xl sm:text-2xl font-light text-gray-800">
            Welcome Back, <span class="text-black font-bold">{{ fullName }}!</span>
          </h2>
          <p
            class="mt-5 text-sm sm:text-base text-gray-500 mx-auto text-justify"
          >
            You have completed
            <span class="text-green-600 font-semibold">60%</span> of your drone
            <br />
            template. You are almost done!
          </p>
        </div>

        <!-- Right Image -->
        <img
          src="../../../assets/dashboard.png"
          alt="Dashboard Illustration"
          class="w-32 mx-5 sm:w-40 md:w-56 max-w-full mt-4 md:mt-0"
        />
      </div>
    </div>

    <span
      class="block font-semibold text-base sm:text-lg leading-none tracking-normal text-gray-800"
    >
      Dashboard
    </span>

    <!-- Dashboard Metrics -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
      <div *ngFor="let stat of stats" class="bg-white p-6 rounded-2xl">
        <h3 class="text-gray-500 text-sm">{{ stat.title }}</h3>
        <h2 class="text-3xl font-bold text-black">{{ stat.value }}</h2>
        <p class="{{ stat.color }} text-[12px] mt-4">
          {{ stat.percent }}
        </p>
        <span class="text-gray-400">{{ stat.since }}</span>
      </div>
    </div>

    <!-- Drone Library Table -->
    <div class="rounded-xl">
      <!-- Header Row -->
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4"
      >
        <h3 class="text-base sm:text-lg font-semibold text-gray-800">
          Drone Library
        </h3>
        <a
          routerLink="/drone-library"
          class="text-sm font-medium underline hover:underline text-[#009169]"
        >
          View All
        </a>
      </div>

      <!-- Table Wrapper -->
      <div class="w-full overflow-x-auto border rounded-[10px] overflow-hidden">
        <table class="min-w-[700px] w-full text-sm text-left border-collapse">
          <thead class="bg-[#FAFAFC] text-gray-500">
            <tr>
              <th class="py-4 px-4 font-medium">Name</th>
              <th class="py-4 px-4 font-medium">Date Created</th>
              <th class="py-4 px-4 font-medium">Last Used</th>
              <th class="py-4 px-4 font-medium">Application</th>
              <th class="py-4 px-4 font-medium">Status</th>
              <!-- Proper column just for dots -->
              <th class="py-4 px-4 w-[40px] text-center">
                <svg
                  width="21"
                  height="5"
                  viewBox="0 0 21 5"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <ellipse
                    cx="2.38019"
                    cy="2.5"
                    rx="1.98956"
                    ry="2"
                    fill="#3A3B3E"
                  />
                  <ellipse
                    cx="10.3568"
                    cy="2.5"
                    rx="1.98956"
                    ry="2"
                    fill="#3A3B3E"
                  />
                  <ellipse
                    cx="18.3411"
                    cy="2.5"
                    rx="1.98956"
                    ry="2"
                    fill="#3A3B3E"
                  />
                </svg>
              </th>
            </tr>
          </thead>

          <!-- âœ… Table Body -->
          <tbody>
            <tr
              *ngFor="let row of tableData"
              class="bg-white border-t border-[#D1DADF]"
            >
              <td class="py-5 px-4 font-medium text-gray-800">
                {{ row.name }}
              </td>
              <td class="py-5 px-4 text-gray-800">{{ row.created }}</td>
              <td class="py-5 px-4 text-gray-800">{{ row.lastUsed }}</td>
              <td class="py-5 px-4 text-gray-800">{{ row.app }}</td>
              <td class="py-5 px-4">
                <span
                  class="px-2 py-1 rounded-full text-xs"
                  [ngClass]="row.statusColor"
                >
                  {{ row.status }}
                </span>
              </td>
              <td
                #dropdownRef
                class="relative px-4 py-3 cursor-pointer"
                (click)="toggleDropdown(row.name)"
              >
                <!-- Dots Button -->
                <button>
                  <svg
                    width="21"
                    height="5"
                    viewBox="0 0 21 5"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <ellipse
                      cx="2.38019"
                      cy="2.5"
                      rx="1.98956"
                      ry="2"
                      fill="#3A3B3E"
                    />
                    <ellipse
                      cx="10.3568"
                      cy="2.5"
                      rx="1.98956"
                      ry="2"
                      fill="#3A3B3E"
                    />
                    <ellipse
                      cx="18.3411"
                      cy="2.5"
                      rx="1.98956"
                      ry="2"
                      fill="#3A3B3E"
                    />
                  </svg>
                </button>

                <!-- Dropdown -->
                <div
                  *ngIf="openDropdown === row.name"
                  class="absolute left-12 top-1/2 -translate-x-[90%] bg-white border border-gray-200 rounded-md z-50"
                >
                  <ul class="text-sm text-gray-700">
                    <li>
                      <a class="block px-4 py-2 hover:bg-gray-100">View</a>
                    </li>
                    <li>
                      <a class="block px-4 py-2 hover:bg-gray-100">Edit</a>
                    </li>
                    <li>
                      <a class="block px-4 py-2 text-red-500 hover:bg-red-50"
                        >Delete</a
                      >
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Right Sidebar -->
  <div class="flex flex-col gap-4">
    <!-- Button below -->
    <div class="mt-4 flex justify-start w-full mx-4">
      <button
        class="w-full h-[40px] bg-[#009169] text-white text-sm rounded-md px-2 py-3 flex items-center justify-center gap-2"
        (click)="showAddDroneModal = true"
      >
        <svg
          width="17"
          height="16"
          viewBox="0 0 17 16"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.38737 1.33301C4.71404 1.33301 1.7207 4.32634 1.7207 7.99967C1.7207 11.673 4.71404 14.6663 8.38737 14.6663C12.0607 14.6663 15.054 11.673 15.054 7.99967C15.054 4.32634 12.0607 1.33301 8.38737 1.33301ZM11.054 8.49967H8.88737V10.6663C8.88737 10.9397 8.6607 11.1663 8.38737 11.1663C8.11404 11.1663 7.88737 10.9397 7.88737 10.6663V8.49967H5.7207C5.44737 8.49967 5.2207 8.27301 5.2207 7.99967C5.2207 7.72634 5.44737 7.49967 5.7207 7.49967H7.88737V5.33301C7.88737 5.05967 8.11404 4.83301 8.38737 4.83301C8.6607 4.83301 8.88737 5.05967 8.88737 5.33301V7.49967H11.054C11.3274 7.49967 11.554 7.72634 11.554 7.99967C11.554 8.27301 11.3274 8.49967 11.054 8.49967Z"
            fill="white"
          />
        </svg>
        Add Drone
      </button>
    </div>

    <!-- Recently Connected -->
    <div
      class="w-full lg:top-[171px] lg:left-[1079px] mx-4 space-y-4 mt-6 lg:mt-0 bg-white border border-[#D1DADF] rounded-lg pb-4"
    >
      <!-- Recently Connected -->
      <span
        class="block text-base sm:px-4 mt-2 sm:text-lg leading-none tracking-normal text-gray-800"
      >
        Recently Connected
      </span>
      <div
        class="w-auto mx-4 bg-white rounded-[8px] border border-t-[#D1DADF] p-4"
        style="margin-top: 0"
      >
        <div
          *ngFor="let card of cards"
          class="flex items-center gap-3 p-[0.5rem] max-w-md w-full"
        >
          <!-- Profile Image + Status Dot -->
          <div class="relative">
            <div
              class="w-10 h-10 rounded-full bg-gray-200 border border-gray-300"
            ></div>
            <div
              class="w-3 h-3 rounded-full absolute bottom-0 right-0 border-2 border-white"
              [ngClass]="card.dotColor"
            ></div>
          </div>

          <!-- Details -->
          <div class="flex-1">
            <div class="flex justify-between items-center">
              <span class="text-sm font-semibold text-gray-900">{{
                card.name
              }}</span>
              <span class="text-xs text-gray-400">{{ card.time }}</span>
            </div>

            <div class="flex items-center mt-2">
              <div class="w-[5rem] bg-gray-200 h-1.5 rounded-full">
                <div
                  class="h-1.5 rounded-full"
                  [ngClass]="card.progressColor"
                  [style.width.%]="card.progress"
                ></div>
              </div>
              <span class="text-xs text-gray-600 ml-2"
                >{{ card.progress }}%</span
              >
            </div>
          </div>
        </div>
      </div>

      <span
        class="block text-base sm:px-5 sm:text-lg leading-none tracking-normal text-gray-800"
      >
        Quick Actions
      </span>
      <!-- Quick Actions -->
      <div
        class="w-auto mx-4 bg-white rounded-[8px] border border-t-[#D1DADF] p-4"
        style="margin-top: 0"
      >
        <div class="space-y-2">
          <div
            class="cursor-pointer h-[40px] bg-white border border-[#D1DADF] rounded-[4px] px-2 py-3 flex items-center gap-2"
          >
            <div class="w-3 h-3 bg-gray-300 rounded-sm"></div>
            <span class="text-sm text-gray-800 font-medium">New Mission</span>
          </div>

          <div
            class="cursor-pointer h-[40px] bg-white border border-[#D1DADF] rounded-[4px] px-2 py-3 flex items-center gap-2"
          >
            <div class="w-3 h-3 bg-gray-300 rounded-sm"></div>
            <span class="text-sm text-gray-800 font-medium">Fleet Status</span>
          </div>

          <div
            class="cursor-pointer h-[40px] bg-white border border-[#D1DADF] rounded-[4px] px-2 py-3 flex items-center gap-2"
          >
            <div class="w-3 h-3 bg-gray-300 rounded-sm"></div>
            <span class="text-sm text-gray-800 font-medium"
              >Run Diagnostics</span
            >
          </div>
        </div>
      </div>
      <span
        class="block text-base sm:px-5 sm:text-lg leading-none tracking-normal text-gray-800"
      >
        Status Panel
      </span>
      <!-- Third Box -->
      <div
        class="w-auto mx-4 bg-white rounded-[8px] border border-t-[#D1DADF] p-4"
        style="margin-top: 0"
      >
        <div
          *ngFor="let task of tasks"
          class="flex justify-between items-center mb-4 last:mb-0"
        >
          <div>
            <p class="text-sm text-gray-800 font-medium">{{ task.title }}</p>
            <p class="text-xs text-gray-500">{{ task.time }}</p>
          </div>
          <span
            class="text-xs px-2 py-0.5 rounded-full font-medium"
            [ngClass]="getBadgeClasses(task.status)"
          >
            {{ task.status }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<app-add-drone
  *ngIf="showAddDroneModal"
  (closeModal)="showAddDroneModal = false"
></app-add-drone>
